<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IP Lookup</title>
  <style>
    :root {
      --bg: #f6f8fa;
      --card-bg: #ffffff;
      --primary: #006aff;
      --text: #333;
      --border: #e1e4e8;
    }
    * { box-sizing: border-box; margin: 0; padding: 0;
        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,
        Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif; }
    body {
      background: var(--bg); color: var(--text);
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; padding: 1rem;
    }
    .card {
      background: var(--card-bg); border: 1px solid var(--border);
      border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,.05);
      max-width: 480px; width: 100%; padding: 2rem 2.5rem; text-align: center;
    }
    h1 { color: var(--primary); font-size: 1.8rem; margin-bottom: 1rem; }
    .info { text-align: left; margin: 1rem 0; line-height: 1.6; word-break: break-all; }
    .info strong { width: 100px; display: inline-block; }
    .visits { margin-top: 1.5rem; font-weight: bold; }
    footer { margin-top: 2rem; font-size: .8rem; color: #777; }
    @media (max-width: 480px) {
      .card { padding: 1.5rem; }
      h1 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="title">IP Lookup</h1>

    <div id="loading">Loading...</div>

    <div id="content" style="display:none;">
      <div class="info" id="ipInfo"></div>
      <div class="visits" id="visits"></div>
    </div>

    <footer><span id="footer-text">Powered by ipapi.co &amp; CounterAPI</span></footer>
  </div>

  <script>
    /* ---------- ????? ---------- */
    const translations = {
      en: {
        title: "IP Lookup", loading: "Loading...",
        ip: "IP", city: "City", region: "Region",
        country: "Country", org: "ISP / Org",
        visits: "Total visits",
        footer: "Powered by ipapi.co & CounterAPI"
      },
      zh: {
        title: "IP ??", loading: "???...",
        ip: "IP ??", city: "??", region: "??",
        country: "??", org: "??? / ??",
        visits: "?????",
        footer: "???? ipapi.co & CounterAPI"
      }
    };

    /* ---------- ???? ---------- */
    const lang = navigator.language.toLowerCase().startsWith("zh") ? "zh" : "en";
    const t = translations[lang];
    document.getElementById("title").textContent = t.title;
    document.getElementById("loading").textContent = t.loading;
    document.getElementById("footer-text").textContent = t.footer;

    /* ---------- ?? IP ?? ---------- */
    async function fetchIPInfo() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        if (!res.ok) throw new Error("ip api error");
        const data = await res.json();
        renderIPInfo(data);
      } catch (e) {
        document.getElementById("loading").textContent = "Failed to load IP info.";
      }
    }

    function renderIPInfo(data) {
      const infoEl = document.getElementById("ipInfo");
      infoEl.innerHTML = `
        <p><strong>${t.ip}:</strong> ${data.ip}</p>
        <p><strong>${t.city}:</strong> ${data.city}</p>
        <p><strong>${t.region}:</strong> ${data.region}</p>
        <p><strong>${t.country}:</strong> ${data.country_name}</p>
        <p><strong>${t.org}:</strong> ${data.org}</p>
      `;
      document.getElementById("loading").style.display = "none";
      document.getElementById("content").style.display = "";
    }

    /* ---------- ???? (CounterAPI) ---------- */
    async function fetchVisits() {
      const namespace = "example.com";   // TODO: ??????????
      const key = "visits";             // TODO: ?????????
      const url = `https://api.counterapi.dev/v1/${namespace}/${key}/up`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("counter api error");
        const data = await res.json();   // ?? { count: 42, ... }
        document.getElementById("visits").textContent =
          `${t.visits}: ${data.count}`;
      } catch (e) {
        console.error(e);
        document.getElementById("visits").textContent =
          `${t.visits}: N/A`;
      }
    }

    /* ---------- ??? ---------- */
    fetchIPInfo();
    fetchVisits();
  </script>
</body>
</html>
